

create table items_18(
  itemID int primary key,
  itemname varchar(50),
  category varchar(50),
  price decimal(10,2),
  instock int check(instock>=0)
);


create table customers_18 (
  custid int primary key,
  custname varchar(100),
  address varchar(255),
  state varchar(50)
);


create table orders_18(
  orderId int primary key,
  itemId int,
  custId int,
  quantity int,
  orderdate date,
  foreign key(itemId) references items_18(itemId),
  foreign key(custID) references customers_18(custId)
);

CREATE TABLE delivery_18 (
  id INT PRIMARY KEY, 
  deliveryId INT NULL,                
  custId INT,
  orderId INT,
  FOREIGN KEY (custId) REFERENCES customers_18(custId),
  FOREIGN KEY (orderId) REFERENCES orders_18(orderId)
);


INSERT INTO items_18 VALUES (1, 'Samsung Galaxy S4', 'Electronics', 599.99, 100);
insert into items_18 values(2, 'Laptop Pro', 'Electronics', 1299.99, 50);
insert into items_18 values(3, 'Running Shoes', 'Sports', 89.99, 200);
insert into items_18 values(4, 'Macbook', 'Electronics', 5400.00, 150);
insert into items_18 values(5, 'Mystery Novel', 'Books', 14.99, 300);



INSERT INTO customers_18 VALUES (1, 'John Doe', '123 Main St, Anytown', 'California');
INSERT INTO customers_18 VALUES(2, 'Jane Smith', '456 Oak Ave, Somewhere', 'New York');
INSERT INTO customers_18 VALUES(3, 'Bob Johnson', '789 Pine Rd, Nowhere', 'Texas');
INSERT INTO customers_18 VALUES(4, 'Alice Brown', '321 Elm St, Everywhere', 'Florida');
INSERT INTO customers_18 VALUES(5, 'Mickey', '654 Maple Dr, Anywhere', 'Washington');

INSERT INTO orders_18 VALUES (1, 1, 1, 1, to_date('2013-01-15', 'yyyy-mm-dd'));
INSERT INTO orders_18 VALUES (2, 2, 2, 1, to_date('2013-02-20', 'yyyy-mm-dd'));
INSERT INTO orders_18 VALUES (3, 3, 3, 2, to_date('2012-06-20', 'yyyy-mm-dd'));
INSERT INTO orders_18 VALUES (4, 4, 4, 1, to_date('2013-04-30', 'yyyy-mm-dd'));
INSERT INTO orders_18 VALUES (5, 5, 5, 3, to_date('2013-05-05', 'yyyy-mm-dd'));

INSERT INTO delivery_18
VALUES (1, 1, 1, 1);
INSERT INTO delivery_18 
VALUES (2, 2, 2, 2);
INSERT INTO delivery_18
VALUES (3, NULL, 3, 3);
INSERT INTO delivery_18 
VALUES (4, 4, 4, 4);



-- 1. List the details of all customers who have placed an order
SELECT DISTINCT c.*
FROM customers_18 c
JOIN orders_18 o ON c.custid = o.custId;

-- 2. List the details of all customers whose orders have been delivered
SELECT DISTINCT c.*
FROM customers_18 c
JOIN delivery_18 d ON c.custid = d.custid;

-- 3. Find the order date for all customers whose name starts with the letter 'J'
SELECT c.custname, o.orderdate
FROM customers_18 c
JOIN orders_18 o ON c.custid = o.custId
WHERE c.custname LIKE 'J%';

-- 4. Display the name and price of all items bought by the customer 'Mickey'
SELECT i.itemname, i.price
FROM items_18 i
JOIN orders_18 o ON i.itemID = o.itemId
JOIN customers_18 c ON o.custId = c.custid
WHERE c.custname = 'Mickey';



-- 5. List the details of all customers who have placed an order after January 2013 and not received delivery of items
SELECT DISTINCT c.*
FROM customers_18 c
JOIN orders_18 o ON c.custid = o.custId
LEFT JOIN delivery_18 d ON o.orderId = d.orderId
WHERE o.orderdate > TO_DATE('2013-01-31', 'YYYY-MM-DD')
  AND d.deliveryId IS NULL;
  
  
--6 Find the itemid of items which has either been ordered or not delivered. (UseSET UNION)
select itemid from orders_18 UNION select itemid from items_18 where itemId NOT IN (select itemId from orders_18 where orderid IN (select orderId from Delivery_18));
  

-- 7. Find the name of all customers who have placed an order and have their orders delivered. (Use SET INTERSECTION)
SELECT custname
FROM customers_18
WHERE custid IN (
    SELECT custId FROM orders_18
    INTERSECT
    SELECT custid FROM delivery_18
);

-- 8. Find the custname of all customers who have placed an order but not having their orders delivered. (Use SET MINUS)
SELECT custname
FROM customers_18
WHERE custid IN (
    SELECT custId FROM orders_18
    MINUS
    SELECT custid FROM delivery_18
);


-- 9. Find the name of the customer who has placed the most number of orders.
SELECT c.custname
FROM customers_18 c
JOIN (
    SELECT custId, COUNT(*) as order_count
    FROM orders_18
    GROUP BY custId
    ORDER BY order_count DESC
    FETCH FIRST 1 ROW ONLY
) o ON c.custid = o.custId;

-- 10. Find the details of all customers who have purchased items exceeding a price of 5000$
SELECT DISTINCT c.*
FROM customers_18 c
JOIN orders_18 o ON c.custid = o.custId
JOIN items_18 i ON o.itemId = i.itemID
WHERE i.price > 5000;

-- 11. Find the name and address of customers who has not ordered a 'Samsung Galaxy S4'
SELECT custname, address
FROM customers_18
WHERE custid NOT IN (
    SELECT o.custId
    FROM orders_18 o
    JOIN items_18 i ON o.itemId = i.itemID
    WHERE i.itemname = 'Samsung Galaxy S4'
);

-- 12. Perform Left Outer Join and Right Outer Join on Customers & Orders Table.
-- Left Outer Join
SELECT c.*, o.*
FROM customers_18 c
LEFT OUTER JOIN orders_18 o ON c.custid = o.custId;

-- Right Outer Join
SELECT c.*, o.*
FROM customers_18 c
RIGHT OUTER JOIN orders_18 o ON c.custid = o.custId;

-- 13. Find the details of all customers grouped by state
SELECT state, COUNT(*) as customer_count,
       LISTAGG(custname, ', ') WITHIN GROUP (ORDER BY custname) as customers
FROM customers_18
GROUP BY state;

-- 14. Display the details of all items grouped by category and having a price greater than average price of all items.
SELECT category, AVG(price) as avg_price,
       LISTAGG(itemname, ', ') WITHIN GROUP (ORDER BY price DESC) as items
FROM items_18
GROUP BY category
HAVING AVG(price) > (SELECT AVG(price) FROM items_18);



table ITEMS_18 created.
table CUSTOMERS_18 created.
table ORDERS_18 created.
table DELIVERY_18 created.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
1 rows inserted.
    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                            
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------
         4 Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          Florida                                            
         2 Jane Smith                                                                                           456 Oak Ave, Somewhere                                                                                                                                                                                                                                          New York                                           
         3 Bob Johnson                                                                                          789 Pine Rd, Nowhere                                                                                                                                                                                                                                            Texas                                              
         5 Mickey                                                                                               654 Maple Dr, Anywhere                                                                                                                                                                                                                                          Washington                                         
         1 John Doe                                                                                             123 Main St, Anytown                                                                                                                                                                                                                                            California                                         

    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                            
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------
         4 Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          Florida                                            
         2 Jane Smith                                                                                           456 Oak Ave, Somewhere                                                                                                                                                                                                                                          New York                                           
         3 Bob Johnson                                                                                          789 Pine Rd, Nowhere                                                                                                                                                                                                                                            Texas                                              
         1 John Doe                                                                                             123 Main St, Anytown                                                                                                                                                                                                                                            California                                         

CUSTNAME                                                                                             ORDERDATE
---------------------------------------------------------------------------------------------------- ---------
John Doe                                                                                             15-01-13  
Jane Smith                                                                                           20-02-13  

ITEMNAME                                                PRICE
-------------------------------------------------- ----------
Mystery Novel                                           14.99 

    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                            
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------
         5 Mickey                                                                                               654 Maple Dr, Anywhere                                                                                                                                                                                                                                          Washington                                         

    ITEMID
----------
         1 
         2 
         3 
         4 
         5 

CUSTNAME                                                                                           
----------------------------------------------------------------------------------------------------
John Doe                                                                                             
Jane Smith                                                                                           
Bob Johnson                                                                                          
Alice Brown                                                                                          

CUSTNAME                                                                                           
----------------------------------------------------------------------------------------------------
Mickey                                                                                               

CUSTNAME                                                                                           
----------------------------------------------------------------------------------------------------
John Doe                                                                                             

    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                            
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------
         4 Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          Florida                                            

CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                       
---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Jane Smith                                                                                           456 Oak Ave, Somewhere                                                                                                                                                                                                                                          
Bob Johnson                                                                                          789 Pine Rd, Nowhere                                                                                                                                                                                                                                            
Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          
Mickey                                                                                               654 Maple Dr, Anywhere                                                                                                                                                                                                                                          

    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                                 ORDERID     ITEMID     CUSTID   QUANTITY ORDERDATE
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------- ---------- ---------- ---------- ---------- ---------
         1 John Doe                                                                                             123 Main St, Anytown                                                                                                                                                                                                                                            California                                                  1          1          1          1 15-01-13  
         2 Jane Smith                                                                                           456 Oak Ave, Somewhere                                                                                                                                                                                                                                          New York                                                    2          2          2          1 20-02-13  
         3 Bob Johnson                                                                                          789 Pine Rd, Nowhere                                                                                                                                                                                                                                            Texas                                                       3          3          3          2 20-06-12  
         4 Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          Florida                                                     4          4          4          1 30-04-13  
         5 Mickey                                                                                               654 Maple Dr, Anywhere                                                                                                                                                                                                                                          Washington                                                  5          5          5          3 05-05-13  

    CUSTID CUSTNAME                                                                                             ADDRESS                                                                                                                                                                                                                                                         STATE                                                 ORDERID     ITEMID     CUSTID   QUANTITY ORDERDATE
---------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------- ---------- ---------- ---------- ---------- ---------
         1 John Doe                                                                                             123 Main St, Anytown                                                                                                                                                                                                                                            California                                                  1          1          1          1 15-01-13  
         2 Jane Smith                                                                                           456 Oak Ave, Somewhere                                                                                                                                                                                                                                          New York                                                    2          2          2          1 20-02-13  
         3 Bob Johnson                                                                                          789 Pine Rd, Nowhere                                                                                                                                                                                                                                            Texas                                                       3          3          3          2 20-06-12  
         4 Alice Brown                                                                                          321 Elm St, Everywhere                                                                                                                                                                                                                                          Florida                                                     4          4          4          1 30-04-13  
         5 Mickey                                                                                               654 Maple Dr, Anywhere                                                                                                                                                                                                                                          Washington                                                  5          5          5          3 05-05-13  

STATE                                              CUSTOMER_COUNT CUSTOMERS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
-------------------------------------------------- -------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
California                                                      1 John Doe                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
Florida                                                         1 Alice Brown                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
New York                                                        1 Jane Smith                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
Texas                                                           1 Bob Johnson                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
Washington                                                      1 Mickey                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

CATEGORY                                            AVG_PRICE ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
-------------------------------------------------- ---------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Electronics                                        2433.326667 Macbook, Laptop Pro, Samsung Galaxy S4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

